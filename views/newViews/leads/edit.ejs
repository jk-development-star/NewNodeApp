<!-- summernote -->
<link
  rel="stylesheet"
  href="/newAssets/plugins/summernote/summernote-bs4.min.css"
/>
<!-- Select2 -->
<link rel="stylesheet" href="/newAssets/plugins/select2/css/select2.min.css" />
<link rel="stylesheet" href="/newAssets/css/style.css" />
<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>Edit Lead</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item">
            <a href="/dashboard">Home</a>
          </li>
          <li class="breadcrumb-item active">Edit Lead</li>
        </ol>
      </div>
    </div>
  </div>
  <!-- /.container-fluid -->
</section>
<% if(messages.error) { %>
<div class="alert alert-danger" role="alert"><%= messages.error %></div>
<% } %> <% if(messages.success) { %>
<div class="alert alert-success" role="alert"><%= messages.success %></div>
<% } %> 
<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <!-- general form elements -->
        <div class="card card-primary">
          <form
            class="form"
            action="/update/lead/<%= lead._id %>?method=put"
            method="POST"
            data-parsley-validate
          >
            <div class="card-body">
              <div>
                <h5>Customer Information</h5>
              
              <div class="row">
                <div class="col-md-6">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="name" class="form-label">Name</label>
                    <input
                      type="text"
                      class="form-control"
                      name="customer_name"
                      id="customer_name"
                      value="<%= lead.customer_name %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group mandatory">
                    <label for="email" class="form-label"
                      >Email Address</label
                    >
                    <input
                      type="email"
                      class="form-control"
                      name="customer_email"
                      id="customer_email"
                      value="<%= lead.customer_email %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="contact" class="form-label"
                      >Contact Number</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      name="customer_phone"
                      id="customer_phone"
                      value="<%= lead.customer_phone %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group mandatory">
                    <label for="email" class="form-label"
                      >Address</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      name="customer_address"
                      id="customer_address"
                      value="<%= lead.customer_address %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="country" class="form-label">Country</label>
                    <input
                      type="text"
                      class="form-control"
                      name="customer_country"
                      id="customer_country"
                      value="<%= lead.customer_country %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group mandatory">
                    <label for="state" class="form-label">State</label>
                    <input
                      type="text"
                      class="form-control"
                      name="customer_state"
                      id="customer_state"
                      value="<%= lead.customer_state %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group mandatory">
                    <label for="city" class="form-label">City</label>
                    <input
                      type="text"
                      class="form-control"
                      name="customer_city"
                      id="customer_city"
                      value="<%= lead.customer_city %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group mandatory">
                    <label for="code" class="form-label">Zip Code</label>
                    <input
                      type="text"
                      class="form-control"
                      name="customer_zipcode"
                      id="customer_zipcode"
                      value="<%= lead.customer_zipcode %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
              </div>
            </div>
            <div>
              <h5>Lead Information</h5>
            
              <div class="row">
                <div class="col-md-4">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="contact" class="form-label">Budget</label>
                    <input
                      type="text"
                      class="form-control edit-budget"
                      name="lead_budget"
                      id="lead_budget"
                      value="<%= lead.lead_budget %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="area" class="form-label">Covered Area</label>
                    <input
                      type="text"
                      class="form-control"
                      name="covered_area"
                      id="covered_area"
                      value="<%= lead.covered_area %>"
                      data-parsley-required="true"
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="status" class="form-label">Lead Status </label>
                    <select
                      class="form-control"
                      name="lead_status"
                      id="lead_status"
                    >
                      <option>Select Status</option>
                      <option data-id="Active" value="Active" <%= lead.lead_status === "Active" ? "selected": "" %>>Active</option>
                      <option data-id="Follow-Up" value="Follow-Up" <%= lead.lead_status === "Follow-Up" ? "selected": "" %>>Follow-Up</option>
                      <option data-id="n-Process" value="In-Process" <%= lead.lead_status === "In-Process" ? "selected": "" %>>In-Process</option>
                      <option data-id="Completed" value="Completed" <%= lead.lead_status === "Completed" ? "selected": "" %>>Completed</option>
                      <option data-id="Closed" value="Closed" <%= lead.lead_status === "Closed" ? "selected": "" %>>Closed</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="assign" class="form-label"
                      >Assign Lead To
                    </label>
                    <select
                        class="select2 assignedTo"
                        data-placeholder="Select Assignee"
                        style="width: 100%"
                        multiple="multiple"
                        name="assignedTo[]"
                        id="assignedTo"
                    >
                      <% if(usersList && usersList !== "undefined") { %> <%
                      usersList.forEach(function (user) { %> 
                      <option value="<%= user._id %>">
                        <%= user.full_name %>
                      </option>
                      <% }) %> <% } else { %>
                      <option>No User Found</option>
                      <% } %>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <!-- text input -->
                  <div class="form-group mandatory">
                    <label for="assign" class="form-label"
                      >Work Category
                    </label>
                    <select
                        class="select2"
                        data-placeholder="Select Work Category"
                        style="width: 100%"
                        multiple="multiple"
                        name="work_category[]"
                        id="work_category"
                    >
                      <% if(usersList && usersList !== "undefined") { %> <%
                      usersList.forEach(function (user) { %> 
                      <option value="<%= user._id %>">
                        <%= user.full_name %>
                      </option>
                      <% }) %> <% } else { %>
                      <option>No User Found</option>
                      <% } %>
                    </select>
                  </div>
                </div>
              </div>
              <div class="action_item_and_task">
                <div class="row ">
                  <div class="col-md-6">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="action_item" class="form-label">Action Item</label>
                      <select name="action_items[]" class="form-control" id="action_items">
                        <option value="">Select Action Item</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mandatory">
                      <label for="email" class="form-label"
                        >Tasks</label
                      >
                      <select name="tasks[]" class="form-control" id="tasks">
                        <option value="">Select Tasks</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label for="follow" class="form-label"
                    >Lead Remark(Follow Up)</label
                  >
                  <textarea class="summernote" name="lead_remark_followup">
                    <%= lead.lead_remark_followup %>
                  </textarea>
                </div>
                <div class="col-md-6">
                  <label for="description" class="form-label"
                    >Lead Decription</label
                  >
                  <textarea class="summernote" name="description">
                    <%= lead.description %>
                  </textarea>
                </div>
                <!-- /.col-->
              </div>

              <!-- /.col-->
            </div>
          </div>
            <div class="card-footer">
              <button type="submit" class="btn btn-sm btn-primary">Submit</button>
              <a class="btn-sm btn-danger float-right" href="/leads"> Back</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="/newAssets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/newAssets/js/leads/lead.edit.js"></script>
<script src="/newAssets/parsleyjs/parsley.min.js"></script>
<script src="/newAssets/js/parsley.js"></script>
<!-- Summernote -->
<script src="/newAssets/plugins/summernote/summernote-bs4.min.js"></script>
<!-- Select2 -->
<script src="/newAssets/plugins/select2/js/select2.full.min.js"></script>

<script>
 const usersData = <%- JSON.stringify(usersList) %>;
  $(function () {
    // Summernote
    $(".summernote").summernote();
  });
  window.addEventListener('load', function(){
    let status = document.querySelector('#lead_status');
    if(status.value === 'Follow-Up' || status.value === 'In-Process' || status.value === 'Completed'){
      document.querySelector('.action_item_and_task').style.display = "block";
    }else{
      document.querySelector('.action_item_and_task').style.display = "none";
    }
    status.addEventListener('change', function(event){
      const statusValue = status.value;
      if(statusValue === 'Follow-Up' || statusValue === 'In-Process' || statusValue === 'Completed'){
        document.querySelector('.action_item_and_task').style.display = "block";
      }else{
        document.querySelector('.action_item_and_task').style.display = "none";
      }
      })
  })
  
 
const userName =[];
 $.each(usersData, function (i, v) {
    userName.push(v["_id"]);
$(document).ready(function() {
  $('.select2').select2().val(userName);
});
});

</script>
