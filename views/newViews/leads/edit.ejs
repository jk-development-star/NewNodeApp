<!-- summernote -->
<link
  rel="stylesheet"
  href="/newAssets/plugins/summernote/summernote-bs4.min.css"
/>
<!-- Select2 -->
<link rel="stylesheet" href="/newAssets/plugins/select2/css/select2.min.css" />
<link
  rel="stylesheet"
  href="/newAssets/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css"
/>
<link rel="stylesheet" href="/newAssets/css/style.css" />
<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>Edit Lead</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item">
            <a href="/dashboard">Home</a>
          </li>
          <li class="breadcrumb-item active">Edit Lead</li>
        </ol>
      </div>
    </div>
  </div>
  <!-- /.container-fluid -->
</section>
<%- include('../../partials/messages') %>

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <!-- general form elements -->
        <div class="card card-primary">
          <form
            class="form"
            action="/update/lead/<%= lead._id %>?method=put"
            method="POST"
            data-parsley-validate
          >
            <div class="card-body">
              <div>
                <h5>Customer Information</h5>

                <div class="row">
                  <div class="col-md-6">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="name" class="form-label">Name</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_name"
                        id="customer_name"
                        value="<%= lead.customer_name %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mandatory">
                      <label for="email" class="form-label"
                        >Email Address</label
                      >
                      <input
                        type="email"
                        class="form-control"
                        name="customer_email"
                        id="customer_email"
                        value="<%= lead.customer_email %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="contact" class="form-label"
                        >Contact Number</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        name="customer_phone"
                        id="customer_phone"
                        value="<%= lead.customer_phone %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mandatory">
                      <label for="email" class="form-label">Address</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_address"
                        id="customer_address"
                        value="<%= lead.customer_address %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="country" class="form-label">Country</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_country"
                        id="customer_country"
                        value="<%= lead.customer_country %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group mandatory">
                      <label for="state" class="form-label">State</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_state"
                        id="customer_state"
                        value="<%= lead.customer_state %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group mandatory">
                      <label for="city" class="form-label">City</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_city"
                        id="customer_city"
                        value="<%= lead.customer_city %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group mandatory">
                      <label for="code" class="form-label">Zip Code</label>
                      <input
                        type="text"
                        class="form-control"
                        name="customer_zipcode"
                        id="customer_zipcode"
                        value="<%= lead.customer_zipcode %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <h5>Lead Information</h5>

                <div class="row">
                  <div class="col-md-4">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="contact" class="form-label">Budget</label>
                      <input
                        type="text"
                        class="form-control edit-budget"
                        name="lead_budget"
                        id="lead_budget"
                        value="<%= lead.lead_budget %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="area" class="form-label">Covered Area</label>
                      <input
                        type="text"
                        class="form-control"
                        name="covered_area"
                        id="covered_area"
                        value="<%= lead.covered_area %>"
                        data-parsley-required="true"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="status" class="form-label"
                        >Lead Status
                      </label>
                      <select
                        class="form-control"
                        name="lead_status"
                        id="lead_status"
                      >
                        <option value="">Select Lead Status</option>
                        <option
                          value="Active"
                          selected="<%= lead.lead_status==='Active' ? 'selected': '' %>"
                        >
                          Active
                        </option>
                        <option
                          value="Follow-Up"
                          selected="<%= lead.lead_status === 'Follow-Up' ? 'selected': '' %>"
                        >
                          Follow-Up
                        </option>
                        <option
                          value="In-Process"
                          selected="<%= lead.lead_status === 'In-Process' ? 'selected': '' %>"
                        >
                          In-Process
                        </option>
                        <option
                          value="Completed"
                          selected="<%= lead.lead_status === 'Completed' ? 'selected': '' %>"
                        >
                          Completed
                        </option>
                        <option
                          value="Closed"
                          selected="<%= lead.lead_status === 'Closed' ? 'selected': '' %>"
                        >
                          Closed
                        </option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <!-- text input -->
                    <div class="form-group mandatory">
                      <label for="assign" class="form-label"
                        >Assign Lead To
                      </label>
                      <select
                        class="select2 assignedTo"
                        data-placeholder="Select Assignee"
                        style="width: 100%"
                        multiple="multiple"
                        name="assignedTo[]"
                        id="assignedTo"
                      >
                        <% if(usersList && usersList !== "undefined") { %> <%
                        usersList.forEach(function (user) { %>
                        <option value="<%= user._id %>">
                          <%= user.full_name %>
                        </option>
                        <% }) %> <% } else { %>
                        <option>No User Found</option>
                        <% } %>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <!-- text input -->
                    <div class="form-group">
                      <label for="work_category" class="form-label"
                        >Work Category</label
                      >
                      <select
                        class="select2 work_category"
                        multiple="multiple"
                        data-placeholder="Select Work Type(s)"
                        style="width: 100%"
                        name="work_category[]"
                        id="work_category"
                      >
                        <option value="KW">Kitchen Wooden</option>
                        <option value="RF">Room Furniture</option>
                        <option value="GW">Gates and Windows</option>
                        <option value="TC">Table and Chairs</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="follow" class="form-label"
                      >Lead Remark(Follow Up)</label
                    >
                    <textarea class="summernote" name="lead_remark_followup">
                    <%= lead.lead_remark_followup %>
                  </textarea
                    >
                  </div>
                  <div class="col-md-6">
                    <label for="description" class="form-label"
                      >Lead Decription</label
                    >
                    <textarea class="summernote" name="description">
                    <%= lead.description %>
                  </textarea
                    >
                  </div>
                  <!-- /.col-->
                </div>

                <!-- /.col-->
              </div>
            </div>

            <div class="card-footer">
              <button type="submit" class="btn btn-sm btn-primary">
                Submit
              </button>
              <a class="btn-sm btn-danger float-right" href="/leads"> Back</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="/newAssets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script>
  const usersData = <%- JSON.stringify(usersList) %>;
  const lead = <%- JSON.stringify(lead) %>;
</script>
<script src="/newAssets/js/leads/lead.edit.js"></script>
<script src="/newAssets/parsleyjs/parsley.min.js"></script>
<script src="/newAssets/js/parsley.js"></script>
<!-- Summernote -->
<script src="/newAssets/plugins/summernote/summernote-bs4.min.js"></script>
<!-- Select2 -->
<script src="/newAssets/plugins/select2/js/select2.full.min.js"></script>
<script>
  $(document).ready(function () {
    let id = [];
    let work = [];
    usersData.forEach((user) => {
      lead.assignedTo.forEach((lead) => {
        if (lead._id === user._id) {
          id.push(lead._id);
          $("#assignedTo").val(id);
        }
      });
    });
    // Initialize Select2
    $("#assignedTo").select2();
    lead.work_category.forEach((work) => {
      work.push(work);
      $("#work_category").val(work);
    });
    $("#work_category").select2();
  });
</script>
